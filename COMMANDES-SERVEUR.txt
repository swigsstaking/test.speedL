â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸš€ COMMANDES DE DÃ‰PLOIEMENT SERVEUR - SWIGS MULTI-SITES ğŸš€
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“… Date: 24 Octobre 2025
ğŸ–¥ï¸  Serveur: sw4c-6 (swigs@serveur)
ğŸ“¦ Repos: swigsstaking/test.speedL
âœ… Commits: 3 commits pushÃ©s sur GitHub

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  OPTION 1: SCRIPT AUTOMATISÃ‰ (RECOMMANDÃ‰)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. Copier le script sur le serveur (depuis votre machine locale)
scp deploy-multi-sites.sh swigs@serveur:~/

# 2. Se connecter au serveur
ssh swigs@serveur

# 3. Rendre le script exÃ©cutable
chmod +x ~/deploy-multi-sites.sh

# 4. ExÃ©cuter le script
./deploy-multi-sites.sh

# Le script va:
# âœ… CrÃ©er des backups (MongoDB, sites, Nginx)
# âœ… DÃ©ployer le Backend (pull + install + restart)
# âœ… DÃ©ployer l'Admin (pull + build + deploy)
# âœ… DÃ©ployer le Control Center (pull + build + deploy)
# âœ… VÃ©rifier que tout fonctionne

# Temps estimÃ©: 5-10 minutes

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  OPTION 2: COMMANDES MANUELLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. Se connecter au serveur
ssh swigs@serveur

# 2. BACKUP (IMPORTANT - Ne pas sauter cette Ã©tape)
mkdir -p ~/backups/mongodb ~/backups/sites ~/backups/nginx
mongodump --db swigs-cms --out ~/backups/mongodb/pre-multi-sites-$(date +%Y%m%d-%H%M)
mongodump --db swigs-monitoring --out ~/backups/mongodb/pre-multi-sites-$(date +%Y%m%d-%H%M)
tar -czf ~/backups/sites/pre-multi-sites-$(date +%Y%m%d-%H%M).tar.gz /var/www/
sudo tar -czf ~/backups/nginx/pre-multi-sites-$(date +%Y%m%d-%H%M).tar.gz /etc/nginx/sites-available/

# 3. BACKEND CMS
cd ~/swigs-apps/swigs-cms-backend
git pull origin main
npm install
pm2 restart swigs-cms-backend
pm2 logs swigs-cms-backend --lines 30
curl http://localhost:3000/api/health

# 4. ADMIN CMS
cd ~/swigs-apps/swigs-cms-admin
git pull origin main
npm install
npm run build
sudo cp -r dist/* /var/www/admin/
sudo chown -R swigs:www-data /var/www/admin
curl -I https://admin.swigs.online

# 5. CONTROL CENTER
cd ~/swigs-apps/swigs-control-center
git pull origin main
npm install
npm run build
sudo cp -r dist/* /var/www/monitoring/
sudo chown -R swigs:www-data /var/www/monitoring
curl -I https://monitoring.swigs.online

# 6. VÃ‰RIFICATIONS
pm2 status
sudo nginx -t
sudo systemctl status mongod
df -h

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  TESTS POST-DÃ‰PLOIEMENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# 1. ADMIN CMS (https://admin.swigs.online)
# - Se connecter
# - Aller dans MÃ©dias â†’ SÃ©lectionner un site â†’ Uploader une image
# - Aller dans SEO â†’ Cliquer sur "+" â†’ CrÃ©er une nouvelle page
# - Aller dans Content â†’ Cliquer sur "Nouvelle section"

# 2. CONTROL CENTER (https://monitoring.swigs.online)
# - Aller dans Sites â†’ Cliquer sur "Ajouter un site"
# - Remplir le formulaire â†’ Enregistrer
# - Tester Modifier et Supprimer

# 3. VÃ‰RIFIER LES LOGS
pm2 logs swigs-cms-backend --lines 50
sudo tail -f /var/log/nginx/admin-error.log
sudo tail -f /var/log/nginx/monitoring-error.log

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  MIGRATION DES MÃ‰DIAS (OPTIONNEL)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Si vous avez des mÃ©dias existants dans /var/www/speed-l/uploads/

# 1. VÃ©rifier
ls -la /var/www/speed-l/uploads/

# 2. CrÃ©er la nouvelle structure
sudo mkdir -p /var/www/uploads/speed-l

# 3. DÃ©placer les mÃ©dias
sudo mv /var/www/speed-l/uploads/* /var/www/uploads/speed-l/

# 4. Permissions
sudo chown -R swigs:www-data /var/www/uploads
sudo chmod -R 775 /var/www/uploads

# 5. Mettre Ã  jour Nginx
sudo nano /etc/nginx/sites-available/speed-l
# Ajouter:
# location /uploads {
#     alias /var/www/uploads;
#     expires 30d;
#     add_header Cache-Control "public, immutable";
#     try_files $uri =404;
# }

sudo nginx -t
sudo nginx -s reload

# 6. CrÃ©er les entrÃ©es MongoDB
# Voir docs/DEPLOIEMENT-MULTI-SITES.md section "Migration des MÃ©dias"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ROLLBACK (EN CAS DE PROBLÃˆME)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# BACKEND
cd ~/swigs-apps/swigs-cms-backend
git log --oneline -5  # Noter le commit prÃ©cÃ©dent
git checkout c5ddafa  # Remplacer par le bon hash
pm2 restart swigs-cms-backend

# ADMIN
cd ~/swigs-apps/swigs-cms-admin
git checkout c5ddafa
npm install
npm run build
sudo cp -r dist/* /var/www/admin/

# CONTROL CENTER
cd ~/swigs-apps/swigs-control-center
git checkout <commit-hash-precedent>
npm install
npm run build
sudo cp -r dist/* /var/www/monitoring/

# MONGODB
ls -la ~/backups/mongodb/
mongorestore --db swigs-cms ~/backups/mongodb/pre-multi-sites-YYYYMMDD-HHMM/swigs-cms/
pm2 restart swigs-cms-backend

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  MONITORING POST-DÃ‰PLOIEMENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Surveiller pendant 24h

# Logs Backend en temps rÃ©el
pm2 logs swigs-cms-backend

# Logs Nginx
sudo tail -f /var/log/nginx/admin-error.log
sudo tail -f /var/log/nginx/monitoring-error.log

# MÃ©triques serveur
htop
df -h

# VÃ©rifier dans le Control Center
# - Ouvrir https://monitoring.swigs.online
# - VÃ©rifier CPU, RAM, Disk
# - VÃ©rifier que tous les sites sont en ligne

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  CHECKLIST FINALE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[ ] Script exÃ©cutÃ© OU commandes manuelles terminÃ©es
[ ] Backups crÃ©Ã©s
[ ] Backend redÃ©marrÃ© sans erreur
[ ] Admin accessible (https://admin.swigs.online)
[ ] Control Center accessible (https://monitoring.swigs.online)
[ ] Tests upload mÃ©dias OK
[ ] Tests ajout pages SEO OK
[ ] Tests ajout sections Content OK
[ ] Tests gestion sites Control Center OK
[ ] Logs vÃ©rifiÃ©s (pas d'erreurs)
[ ] Monitoring actif pendant 24h

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  URLS Ã€ TESTER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Admin CMS: https://admin.swigs.online
âœ… Control Center: https://monitoring.swigs.online
âœ… API Backend: http://localhost:3000/api/health
âœ… Speed-L: https://speed-l.swigs.online

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  DOCUMENTATION COMPLÃˆTE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“š RESUME-FINAL.md - Vue d'ensemble complÃ¨te
ğŸ“š COMMANDES-DEPLOIEMENT.md - Guide de dÃ©ploiement
ğŸ“š docs/DEPLOIEMENT-MULTI-SITES.md - Guide dÃ©taillÃ©
ğŸ“š docs/MODIFICATIONS-MULTI-SITES.md - RÃ©sumÃ© technique
ğŸ“š docs/ANALYSE-MULTI-SITES.md - Analyse des problÃ¨mes

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  SUPPORT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

En cas de problÃ¨me:

1. VÃ©rifier les logs:
   pm2 logs swigs-cms-backend --lines 100
   sudo tail -f /var/log/nginx/admin-error.log

2. Consulter la documentation:
   cat ~/swigs-apps/swigs-cms-backend/../docs/DEPLOIEMENT-MULTI-SITES.md

3. Rollback si nÃ©cessaire (voir section ci-dessus)

4. VÃ©rifier l'Ã©tat des services:
   pm2 status
   sudo systemctl status nginx
   sudo systemctl status mongod

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… TOUT EST PRÃŠT POUR LE DÃ‰PLOIEMENT !

Prochaine Ã©tape: ExÃ©cuter le script deploy-multi-sites.sh

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Auteur: Cascade AI
Date: 24 Octobre 2025
Version: 1.0
Commits GitHub: e1d3953, 1ab8f43, 16d42ad
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
